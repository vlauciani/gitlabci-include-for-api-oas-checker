api-oas-checker:
  extends: .dind2
  variables:
    INCLUDE_OPENAPI_BASEDIR: "default"
    INCLUDE_OPENAPI_FILENAME: "default"
  script:
    - OPENAPI_FULLDIR="$(pwd)/${INCLUDE_OPENAPI_BASEDIR}"
    - echo "INCLUDE_OPENAPI_BASEDIR=${INCLUDE_OPENAPI_BASEDIR}"
    - echo "INCLUDE_OPENAPI_FILENAME=${INCLUDE_OPENAPI_FILENAME}"
    - echo "OPENAPI_FULLDIR=${OPENAPI_FULLDIR}"
    - ls -l ${OPENAPI_FULLDIR}
    - docker run --rm --entrypoint=sh -v ${OPENAPI_FULLDIR}:/tmp stoplight/spectral:5.9.1 -c "spectral lint -r https://italia.github.io/api-oas-checker/spectral.yml /tmp/${INCLUDE_OPENAPI_FILENAME}"
  #after_script:
  #  - docker images    

.dind2:
  image: 
    name: docker:19.03.2
    #entrypoint: [""]
  services:
    - docker:19.03.2-dind 
